<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Parksy Mermaid Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Parksy Mermaid Diagram Viewer - Mermaid ì½”ë“œ ë¶™ì—¬ë„£ê³  ë°”ë¡œ ë‹¤ì´ì–´ê·¸ë¨ í™•ì¸í•˜ê¸°" />

  <!-- Mermaid.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

  <style>
    :root {
      --bg: #fdf6e3;
      --panel-bg: #ffffff;
      --border: #e0d6c4;
      --accent: #2aa198;
      --accent-soft: #e0f7f3;
      --text-main: #333333;
      --text-sub: #666666;
      --danger: #e74c3c;
      --code-bg: #002b36;
      --code-text: #fdf6e3;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px 12px 32px;
    }

    header {
      margin-bottom: 12px;
      padding: 12px 12px 4px;
    }

    header h1 {
      font-size: 1.4rem;
      margin: 0 0 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    header h1 span.logo {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: var(--accent);
      color: #fff;
      font-weight: 700;
      font-size: 0.85rem;
    }

    header .subtitle {
      font-size: 0.85rem;
      color: var(--text-sub);
    }

    .layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }

    @media (min-width: 840px) {
      .layout {
        grid-template-columns: minmax(0, 1.05fr) minmax(0, 1.2fr);
      }
    }

    .panel {
      background: var(--panel-bg);
      border-radius: 14px;
      border: 1px solid var(--border);
      padding: 12px 12px 14px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.04);
    }

    .panel h2 {
      font-size: 1rem;
      margin: 0 0 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .panel h2 span.badge {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--accent);
      background: var(--accent-soft);
      padding: 2px 6px;
      border-radius: 999px;
    }

    .helper-text {
      font-size: 0.78rem;
      color: var(--text-sub);
      margin-bottom: 6px;
      line-height: 1.5;
    }

    textarea {
      width: 100%;
      min-height: 210px;
      resize: vertical;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.82rem;
      background: var(--code-bg);
      color: var(--code-text);
      line-height: 1.4;
    }

    textarea::placeholder {
      color: #93a1a1;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 7px 14px;
      font-size: 0.8rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: transform 0.06s ease, box-shadow 0.06s ease, opacity 0.06s ease;
      background: #eee;
      color: var(--text-main);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);
    }

    button span.emoji {
      font-size: 1rem;
    }

    button.primary {
      background: linear-gradient(135deg, #34c759, #1f9f4d);
      color: #fff;
    }

    button.outline {
      background: #fff;
      border: 1px solid var(--border);
      box-shadow: none;
    }

    button.danger {
      background: #fff5f4;
      border: 1px solid #f4b4aa;
      color: #b92418;
      box-shadow: none;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.08);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
      opacity: 0.9;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 6px;
    }

    .chip {
      font-size: 0.74rem;
      border-radius: 999px;
      padding: 4px 9px;
      background: #f2ede2;
      color: #6c5d3d;
      border: 1px solid #e0d6c4;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
    }

    .chip:hover {
      background: #e7dece;
    }

    .preview-wrapper {
      border-radius: 12px;
      border: 1px dashed var(--border);
      padding: 8px;
      min-height: 220px;
      background: #fbfaf7;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: auto;
    }

    #diagramPreview {
      width: 100%;
    }

    .preview-placeholder {
      text-align: center;
      font-size: 0.85rem;
      color: var(--text-sub);
    }

    .status {
      margin-top: 6px;
      font-size: 0.78rem;
      color: var(--text-sub);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .status .error {
      color: var(--danger);
    }

    footer {
      margin-top: 18px;
      font-size: 0.78rem;
      color: var(--text-sub);
      text-align: center;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    .code-label {
      font-size: 0.75rem;
      color: var(--text-sub);
      margin-bottom: 4px;
    }

    .small {
      font-size: 0.74rem;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>
        <span class="logo">M</span>
        Parksy Mermaid Viewer
      </h1>
      <div class="subtitle">
        Mermaid ì½”ë“œ ë¶™ì—¬ë„£ê³  ë°”ë¡œ ë‹¤ì´ì–´ê·¸ë¨ í™•ì¸ Â· ê³µìœ  ë§í¬ ìƒì„± Â· SVG ë³µì‚¬
      </div>
    </header>

    <main class="layout">
      <!-- ì™¼ìª½: ì½”ë“œ ì…ë ¥ -->
      <section class="panel">
        <h2>
          <span>ğŸ§  ì½”ë“œ ì…ë ¥</span>
          <span class="badge">Parksy Module</span>
        </h2>
        <p class="helper-text">
          í‹°ìŠ¤í† ë¦¬Â·PWAÂ·ì—‘ì…€ ë“± ì–´ë””ì„œë“  ë§Œë“  <b>Mermaid ì½”ë“œ</b>ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.<br />
          <span class="small">â€» ì•ë’¤ <code>```mermaid</code> / <code>```</code> ê°™ì€ ê±´ í¬í•¨ë¼ ìˆì–´ë„ ìë™ìœ¼ë¡œ ì •ë¦¬í•©ë‹ˆë‹¤.</span>
        </p>

        <div class="code-label">Mermaid ì½”ë“œ</div>
        <textarea id="mermaidInput" placeholder="ì—¬ê¸°ì— Mermaid ë‹¤ì´ì–´ê·¸ë¨ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>

        <div class="controls">
          <button class="primary" id="renderBtn">
            <span class="emoji">ğŸ¨</span> ë‹¤ì´ì–´ê·¸ë¨ ë Œë”
          </button>
          <button class="outline" id="sampleFlow">
            <span class="emoji">ğŸ§©</span> ìƒ˜í”Œ: Flowchart
          </button>
          <button class="outline" id="sampleTimeline">
            <span class="emoji">â±ï¸</span> ìƒ˜í”Œ: Timeline
          </button>
          <button class="outline" id="sampleGraph">
            <span class="emoji">ğŸ§¬</span> ìƒ˜í”Œ: Node Graph
          </button>
          <button class="danger" id="clearBtn">
            <span class="emoji">ğŸ§¹</span> ì „ì²´ ì§€ìš°ê¸°
          </button>
        </div>

        <div class="chip-row">
          <div class="chip" id="shareLinkBtn">ğŸ”— ê³µìœ  ë§í¬ ë§Œë“¤ê¸°</div>
          <div class="chip" id="copySvgBtn">ğŸ“‹ SVG ì½”ë“œ ë³µì‚¬</div>
          <div class="chip" id="copyCodeBtn">ğŸ“‹ Mermaid ì½”ë“œ ë³µì‚¬</div>
        </div>

        <div class="status" id="statusBar">
          <span id="statusMessage">ìƒíƒœ: ì¤€ë¹„ ì™„ë£Œ</span>
          <span id="statusLength"></span>
        </div>
      </section>

      <!-- ì˜¤ë¥¸ìª½: ë¯¸ë¦¬ë³´ê¸° -->
      <section class="panel">
        <h2>
          <span>ğŸ” ë‹¤ì´ì–´ê·¸ë¨ ë¯¸ë¦¬ë³´ê¸°</span>
          <span class="badge">Mermaid.js</span>
        </h2>
        <p class="helper-text">
          GitHub Pages í™˜ê²½ì—ì„œ <b>Mermaid.js</b>ë¡œ ì§ì ‘ ë Œë”ë§í•©ë‹ˆë‹¤.<br />
          í™•ëŒ€Â·ìŠ¤í¬ë¡¤ ëª¨ë‘ ììœ ë¡­ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>

        <div class="preview-wrapper" id="previewWrapper">
          <div id="diagramPreview" class="preview-placeholder">
            Mermaid ì½”ë“œë¥¼ ì…ë ¥í•œ ë’¤<br />
            <b>â€œğŸ¨ ë‹¤ì´ì–´ê·¸ë¨ ë Œë”â€</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
          </div>
        </div>

        <div class="status">
          <span class="small">
            URL íŒŒë¼ë¯¸í„°: <code>?code=...</code> ë¡œ ë‹¤ì´ì–´ê·¸ë¨ì„ ë°”ë¡œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </span>
        </div>
      </section>
    </main>

    <footer>
      <div>ğŸ§© Parksy Mermaid Diagram Engine Viewer v1.0</div>
      <div>Â© 2025 dtslib.com | EduArt Engineer</div>
    </footer>
  </div>

  <script>
    // Mermaid ì´ˆê¸°í™”
    mermaid.initialize({
      startOnLoad: false,
      theme: "default", // í•„ìš”í•˜ë©´ 'dark', 'forest' ë“±ìœ¼ë¡œ êµì²´ ê°€ëŠ¥
      securityLevel: "loose"
    });

    const inputEl = document.getElementById("mermaidInput");
    const previewEl = document.getElementById("diagramPreview");
    const statusMessageEl = document.getElementById("statusMessage");
    const statusLengthEl = document.getElementById("statusLength");
    const previewWrapperEl = document.getElementById("previewWrapper");

    // ì½”ë“œ ì •ë¦¬: ```mermaid ... ``` / ì•ë’¤ ê³µë°± ì œê±°
    function normalizeMermaidCode(raw) {
      if (!raw) return "";
      let code = raw.trim();

      // ì•ë’¤ ì½”ë“œ íœìŠ¤ ì œê±°
      if (code.startsWith("```")) {
        const lines = code.split("\n");
        // ì²« ì¤„ì´ ``` ë˜ëŠ” ```mermaid ì¼ ë•Œ ì œê±°
        if (lines[0].trim().startsWith("```")) {
          lines.shift();
        }
        // ë§ˆì§€ë§‰ ì¤„ì´ ``` ì´ë©´ ì œê±°
        if (lines.length && lines[lines.length - 1].trim() === "```") {
          lines.pop();
        }
        code = lines.join("\n").trim();
      }

      return code;
    }

    // ìƒíƒœë°” ì—…ë°ì´íŠ¸
    function updateStatus(message, isError = false) {
      statusMessageEl.textContent = "ìƒíƒœ: " + message;
      statusMessageEl.classList.toggle("error", isError);

      const len = inputEl.value.length;
      statusLengthEl.textContent = len ? `ê¸¸ì´: ${len}ì` : "";
    }

    // Mermaid ë Œë”ë§
    async function renderDiagram() {
      const raw = inputEl.value;
      const code = normalizeMermaidCode(raw);

      if (!code) {
        previewEl.innerHTML = '<div class="preview-placeholder">Mermaid ì½”ë“œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.</div>';
        updateStatus("ì½”ë“œ ì—†ìŒ", true);
        return;
      }

      updateStatus("ë Œë”ë§ ì¤‘...");

      try {
        // idëŠ” ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±í•´ì„œ ìºì‹œ ë¬¸ì œ ë°©ì§€
        const uniqueId = "diagram-" + Date.now();
        const result = await mermaid.render(uniqueId, code);
        previewEl.innerHTML = result.svg;
        updateStatus("ë Œë”ë§ ì™„ë£Œ");
      } catch (err) {
        console.error(err);
        previewEl.innerHTML =
          '<div class="preview-placeholder" style="color:#e74c3c;">â›” Mermaid êµ¬ë¬¸ ì˜¤ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤.<br>ì½˜ì†”ì„ í™•ì¸í•˜ê±°ë‚˜ ì½”ë“œë¥¼ ë‹¤ì‹œ ì ê²€í•´ ì£¼ì„¸ìš”.</div>';
        updateStatus("Mermaid êµ¬ë¬¸ ì˜¤ë¥˜", true);
      }
    }

    // ìƒ˜í”Œë“¤
    const samples = {
      flow: `%% Parksy Mermaid Module
%% ê°„ë‹¨í•œ Flowchart ì˜ˆì‹œ

flowchart TD
  A[ì•„ì´ë””ì–´] --> B[êµ¬ì¡°í™”]
  B --> C[Mermaid ì½”ë“œ]
  C --> D[Excalidraw / PWA / Tistory]
  D --> E[ì¶œíŒ / ë°©ì†¡]`,
      timeline: `%% Parksy Mermaid Module
%% íƒ€ì„ë¼ì¸ ì˜ˆì‹œ

timeline
  title ì‘ì—… íƒ€ì„ë¼ì¸
  S1 : ì•„ì´ë””ì–´ ìˆ˜ì§‘
  S2 : Mermaid ëª¨ë“ˆ ì„¤ê³„
  S3 : Excalidraw ì‹œê°í™”
  S4 : í‹°ìŠ¤í† ë¦¬ / PWA ê²Œì‹œ`,
      graph: `%% Parksy Mermaid Module
%% ë¶„ì êµ¬ì¡° ëŠë‚Œì˜ Node Graph

graph TD
  C((ì¤‘ì•™ ê°œë…))
  A((ëª¨ë“ˆ 1))
  B((ëª¨ë“ˆ 2))
  D((ëª¨ë“ˆ 3))
  E((ëª¨ë“ˆ 4))

  C -- 1 --> A
  C -- 2 --> B
  C -- 3 --> D
  C -- 4 --> E`
    };

    function loadSample(name) {
      const sample = samples[name];
      if (!sample) return;
      inputEl.value = sample;
      updateStatus("ìƒ˜í”Œ ë¡œë“œë¨");
      renderDiagram();
    }

    // ê³µìœ  ë§í¬ ìƒì„± (?code=...)
    function createShareLink() {
      const raw = inputEl.value;
      const code = normalizeMermaidCode(raw);
      if (!code) {
        updateStatus("ê³µìœ í•  ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.", true);
        return;
      }

      const url = new URL(window.location.href);
      url.searchParams.set("code", code); // ìë™ ì¸ì½”ë”©
      const shareUrl = url.toString();

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(shareUrl).then(() => {
          updateStatus("ê³µìœ  ë§í¬ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.");
        }).catch(() => {
          updateStatus("ë§í¬ ë³µì‚¬ ì‹¤íŒ¨. ì£¼ì†Œì°½ì—ì„œ ì§ì ‘ ë³µì‚¬í•˜ì„¸ìš”.", true);
          alert(shareUrl);
        });
      } else {
        updateStatus("ë¸Œë¼ìš°ì €ì—ì„œ ìë™ ë³µì‚¬ê°€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", true);
        alert(shareUrl);
      }
    }

    // SVG ì½”ë“œ ë³µì‚¬
    function copySvg() {
      const svg = previewEl.querySelector("svg");
      if (!svg) {
        updateStatus("ë³µì‚¬í•  SVGê°€ ì—†ìŠµë‹ˆë‹¤.", true);
        return;
      }
      const svgText = svg.outerHTML;
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(svgText).then(() => {
          updateStatus("SVG ì½”ë“œë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.");
        }).catch(() => {
          updateStatus("SVG ë³µì‚¬ ì‹¤íŒ¨", true);
        });
      } else {
        updateStatus("ë¸Œë¼ìš°ì €ì—ì„œ í´ë¦½ë³´ë“œ ë³µì‚¬ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", true);
      }
    }

    // Mermaid ì½”ë“œ ê·¸ëŒ€ë¡œ ë³µì‚¬
    function copyCode() {
      const raw = inputEl.value;
      if (!raw.trim()) {
        updateStatus("ë³µì‚¬í•  ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.", true);
        return;
      }
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(raw).then(() => {
          updateStatus("Mermaid ì½”ë“œë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.");
        }).catch(() => {
          updateStatus("ì½”ë“œ ë³µì‚¬ ì‹¤íŒ¨", true);
        });
      } else {
        updateStatus("ë¸Œë¼ìš°ì €ì—ì„œ í´ë¦½ë³´ë“œ ë³µì‚¬ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", true);
      }
    }

    // URL íŒŒë¼ë¯¸í„°ì—ì„œ code ë¡œë“œ
    function loadFromUrl() {
      const params = new URLSearchParams(window.location.search);
      const code = params.get("code");
      if (code) {
        inputEl.value = code;
        updateStatus("URLì—ì„œ ì½”ë“œ ë¡œë“œë¨");
        renderDiagram();
      } else {
        // ì•„ë¬´ê²ƒë„ ì—†ìœ¼ë©´ ê¸°ë³¸ ìƒ˜í”Œ í•˜ë‚˜ ë¡œë“œ
        loadSample("timeline");
      }
    }

    // ì´ë²¤íŠ¸ ë°”ì¸ë”©
    document.getElementById("renderBtn").addEventListener("click", renderDiagram);
    document.getElementById("sampleFlow").addEventListener("click", () => loadSample("flow"));
    document.getElementById("sampleTimeline").addEventListener("click", () => loadSample("timeline"));
    document.getElementById("sampleGraph").addEventListener("click", () => loadSample("graph"));

    document.getElementById("clearBtn").addEventListener("click", () => {
      inputEl.value = "";
      previewEl.innerHTML =
        '<div class="preview-placeholder">Mermaid ì½”ë“œë¥¼ ì…ë ¥í•œ ë’¤<br><b>â€œğŸ¨ ë‹¤ì´ì–´ê·¸ë¨ ë Œë”â€</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>';
      updateStatus("ì…ë ¥ ë‚´ìš© ì´ˆê¸°í™”");
    });

    document.getElementById("shareLinkBtn").addEventListener("click", createShareLink);
    document.getElementById("copySvgBtn").addEventListener("click", copySvg);
    document.getElementById("copyCodeBtn").addEventListener("click", copyCode);

    inputEl.addEventListener("input", () => {
      updateStatus("í¸ì§‘ ì¤‘");
    });

    // ì´ˆê¸° ë¡œë“œ
    loadFromUrl();
  </script>
</body>
</html>
