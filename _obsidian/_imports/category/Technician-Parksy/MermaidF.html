<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Parksy Mermaid Viewer & Engine v2.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Parksy Mermaid Diagram Viewer & Engine - ì˜µì…˜ìœ¼ë¡œ Mermaid ì½”ë“œ ìƒì„± + ë‹¤ì´ì–´ê·¸ë¨ ë¯¸ë¦¬ë³´ê¸°" />

  <!-- Mermaid.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

  <style>
    :root {
      --bg: #fdf6e3;
      --panel-bg: #ffffff;
      --border: #e0d6c4;
      --accent: #2aa198;
      --accent-soft: #e0f7f3;
      --text-main: #333333;
      --text-sub: #666666;
      --danger: #e74c3c;
      --code-bg: #002b36;
      --code-text: #fdf6e3;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }
    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px 12px 32px;
    }
    header {
      margin-bottom: 12px;
      padding: 12px 12px 4px;
    }
    header h1 {
      font-size: 1.4rem;
      margin: 0 0 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    header h1 .logo {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: var(--accent);
      color: #fff;
      font-weight: 700;
      font-size: 0.85rem;
    }
    header .subtitle {
      font-size: 0.85rem;
      color: var(--text-sub);
    }
    .layout {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }
    @media (min-width: 840px) {
      .layout {
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
      }
    }
    .panel {
      background: var(--panel-bg);
      border-radius: 14px;
      border: 1px solid var(--border);
      padding: 12px 12px 14px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.04);
    }
    .panel h2 {
      font-size: 1rem;
      margin: 0 0 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .panel h2 .badge {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--accent);
      background: var(--accent-soft);
      padding: 2px 6px;
      border-radius: 999px;
    }
    .helper-text {
      font-size: 0.78rem;
      color: var(--text-sub);
      margin-bottom: 6px;
      line-height: 1.5;
    }
    .small { font-size: 0.74rem; }

    textarea {
      width: 100%;
      min-height: 210px;
      resize: vertical;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.82rem;
      background: var(--code-bg);
      color: var(--code-text);
      line-height: 1.4;
    }
    textarea::placeholder { color: #93a1a1; }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }
    button {
      border-radius: 999px;
      border: none;
      padding: 7px 14px;
      font-size: 0.8rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: transform 0.06s ease, box-shadow 0.06s ease, opacity 0.06s ease;
      background: #eee;
      color: var(--text-main);
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
    }
    button .emoji { font-size: 1rem; }
    button.primary {
      background: linear-gradient(135deg, #34c759, #1f9f4d);
      color: #fff;
    }
    button.outline {
      background: #fff;
      border: 1px solid var(--border);
      box-shadow: none;
    }
    button.danger {
      background: #fff5f4;
      border: 1px solid #f4b4aa;
      color: #b92418;
      box-shadow: none;
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 3px 6px rgba(0,0,0,0.08);
    }
    button:active {
      transform: translateY(0);
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
      opacity: 0.9;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 6px;
    }
    .chip {
      font-size: 0.74rem;
      border-radius: 999px;
      padding: 4px 9px;
      background: #f2ede2;
      color: #6c5d3d;
      border: 1px solid #e0d6c4;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
    }
    .chip:hover { background: #e7dece; }

    .preview-wrapper {
      border-radius: 12px;
      border: 1px dashed var(--border);
      padding: 8px;
      min-height: 220px;
      background: #fbfaf7;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: auto;
    }
    #diagramPreview { width: 100%; }
    .preview-placeholder {
      text-align: center;
      font-size: 0.85rem;
      color: var(--text-sub);
    }

    .status {
      margin-top: 6px;
      font-size: 0.78rem;
      color: var(--text-sub);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }
    .status .error { color: var(--danger); }

    footer {
      margin-top: 18px;
      font-size: 0.78rem;
      color: var(--text-sub);
      text-align: center;
    }
    footer a {
      color: var(--accent);
      text-decoration: none;
    }
    footer a:hover { text-decoration: underline; }

    .code-label {
      font-size: 0.75rem;
      color: var(--text-sub);
      margin: 6px 0 4px;
    }

    /* ì—”ì§„ ë°•ìŠ¤ */
    .engine-box {
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 8px 9px 10px;
      margin-bottom: 10px;
      background: #fbfaf7;
    }
    .engine-box h3 {
      font-size: 0.9rem;
      margin: 0 0 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .engine-box h3 .tag {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: #f2ede2;
      color: #6c5d3d;
    }
    .engine-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 6px;
    }
    @media (min-width: 640px) {
      .engine-grid {
        grid-template-columns: 1.2fr 1.1fr;
      }
    }
    .form-row {
      display: flex;
      flex-direction: column;
      gap: 2px;
      margin-bottom: 4px;
    }
    .form-row label {
      font-size: 0.8rem;
      color: var(--text-sub);
    }
    .form-row input,
    .form-row select {
      border-radius: 8px;
      border: 1px solid var(--border);
      padding: 5px 8px;
      font-size: 0.8rem;
      font-family: inherit;
    }
    .form-row input[type="number"] {
      width: 100%;
    }
    .inline-hint {
      font-size: 0.74rem;
      color: var(--text-sub);
      margin-top: 2px;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>
        <span class="logo">M</span>
        Parksy Mermaid Viewer
      </h1>
      <div class="subtitle">
        Mermaid ì½”ë“œ ë¶™ì—¬ë„£ê¸° + ì˜µì…˜ ê¸°ë°˜ ì½”ë“œ ìƒì„± Â· ë‹¤ì´ì–´ê·¸ë¨ ë¯¸ë¦¬ë³´ê¸° Â· SVG ë³µì‚¬
      </div>
    </header>

    <main class="layout">
      <!-- ì™¼ìª½: ì—”ì§„ + ì½”ë“œ ì…ë ¥ -->
      <section class="panel">
        <h2>
          <span>ğŸ§  ì½”ë“œ ì…ë ¥ & ì—”ì§„</span>
          <span class="badge">Parksy Module</span>
        </h2>

        <!-- ì—”ì§„ ë°•ìŠ¤ -->
        <div class="engine-box">
          <h3>âš™ï¸ Mermaid ë‹¤ì´ì–´ê·¸ë¨ ì—”ì§„ <span class="tag">ì˜µì…˜ â†’ ì½”ë“œ</span></h3>
          <p class="helper-text">
            ìì£¼ ì“°ëŠ” íŒ¨í„´ì€ ì—¬ê¸°ì„œ <b>ì˜µì…˜ë§Œ ë°”ê¿”ì„œ</b> ë½‘ì•„ì“°ê³ , ì„¸ë¶€ í…ìŠ¤íŠ¸ëŠ” ì•„ë˜ ì½”ë“œ ì˜ì—­ì—ì„œ ì†ìœ¼ë¡œ í´ë¦¬ì‹±í•˜ëŠ” íë¦„.
          </p>

          <div class="engine-grid">
            <div>
              <div class="form-row">
                <label for="engineDiagramType">ë‹¤ì´ì–´ê·¸ë¨ íƒ€ì…</label>
                <select id="engineDiagramType">
                  <option value="timeline">íƒ€ì„ë¼ì¸ (timeline)</option>
                  <option value="grid">8Ã—8 ê·¸ë¦¬ë“œ (flowchart)</option>
                  <option value="radial">ë¶„ì/ë°©ì‚¬í˜• (mindmap)</option>
                  <option value="tree">ê°€ê³„ë„/íŠ¸ë¦¬ (graph TD)</option>
                </select>
              </div>

              <div class="form-row">
                <label for="engineTitle">íƒ€ì´í‹€</label>
                <input id="engineTitle" type="text" placeholder="ì˜ˆ: ì‘ì—… íƒ€ì„ë¼ì¸ / 8Ã—8 ë¸Œë ˆì´í¬ë‹¤ìš´" />
              </div>
            </div>

            <div>
              <div class="form-row">
                <label id="primaryLabel" for="enginePrimaryCount">ì£¼ ê°œìˆ˜</label>
                <input id="enginePrimaryCount" type="number" min="1" max="8" value="4" />
                <div id="primaryHint" class="inline-hint">íƒ€ì„ë¼ì¸ ë‹¨ê³„ / í–‰ / ë¸Œëœì¹˜ / ìì‹ ê°œìˆ˜ (1~8)</div>
              </div>

              <div class="form-row" id="secondaryRow" style="display:none;">
                <label id="secondaryLabel" for="engineSecondaryCount">ë³´ì¡° ê°œìˆ˜</label>
                <input id="engineSecondaryCount" type="number" min="1" max="8" value="4" />
                <div id="secondaryHint" class="inline-hint">ê·¸ë¦¬ë“œì˜ ì—´ ê°œìˆ˜ë‚˜ ì†ì ê°œìˆ˜ (1~8)</div>
              </div>
            </div>
          </div>

          <div class="controls" style="margin-top:6px;">
            <button class="primary" id="engineGenerateBtn">
              <span class="emoji">ğŸ§±</span> ì˜µì…˜ìœ¼ë¡œ Mermaid ì½”ë“œ ìƒì„±
            </button>
            <button class="outline" id="engineSampleTimelineBtn">
              <span class="emoji">â±ï¸</span> ì—”ì§„ ìƒ˜í”Œ: íƒ€ì„ë¼ì¸
            </button>
          </div>
        </div>

        <!-- ì§ì ‘ ì½”ë“œ ì…ë ¥ ì˜ì—­ -->
        <p class="helper-text">
          í‹°ìŠ¤í† ë¦¬Â·PWAÂ·ì—‘ì…€ ë“± ì–´ë””ì„œë“  ë§Œë“  <b>Mermaid ì½”ë“œ</b>ë¥¼ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ì–´ë„ ë©ë‹ˆë‹¤.
          <br /><span class="small">â€» ì•ë’¤ <code>```mermaid</code> / <code>```</code> ëŠ” ìˆì–´ë„ ë˜ê³  ì—†ì–´ë„ ë©ë‹ˆë‹¤.</span>
        </p>

        <div class="code-label">Mermaid ì½”ë“œ</div>
        <textarea id="mermaidInput" placeholder="ì—¬ê¸°ì— Mermaid ë‹¤ì´ì–´ê·¸ë¨ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ê±°ë‚˜, ìœ„ ì—”ì§„ìœ¼ë¡œ ìƒì„±í•œ ì½”ë“œë¥¼ ìˆ˜ì •í•´ ì“°ì„¸ìš”."></textarea>

        <div class="controls">
          <button class="primary" id="renderBtn">
            <span class="emoji">ğŸ¨</span> ë‹¤ì´ì–´ê·¸ë¨ ë Œë”
          </button>
          <button class="outline" id="sampleFlow">
            <span class="emoji">ğŸ§©</span> ìƒ˜í”Œ: Flowchart
          </button>
          <button class="outline" id="sampleTimeline">
            <span class="emoji">â±ï¸</span> ìƒ˜í”Œ: Timeline
          </button>
          <button class="outline" id="sampleGraph">
            <span class="emoji">ğŸ§¬</span> ìƒ˜í”Œ: Node Graph
          </button>
          <button class="danger" id="clearBtn">
            <span class="emoji">ğŸ§¹</span> ì´ˆê¸°í™”
          </button>
        </div>

        <div class="chip-row">
          <div class="chip" id="shareLinkBtn">ğŸ”— ê³µìœ  ë§í¬ ë§Œë“¤ê¸°</div>
          <div class="chip" id="copySvgBtn">ğŸ“‹ SVG ì½”ë“œ ë³µì‚¬</div>
          <div class="chip" id="copyCodeBtn">ğŸ“‹ Mermaid ì½”ë“œ ë³µì‚¬</div>
        </div>

        <div class="status" id="statusBar">
          <span id="statusMessage">ìƒíƒœ: ì¤€ë¹„ ì™„ë£Œ</span>
          <span id="statusLength"></span>
        </div>
      </section>

      <!-- ì˜¤ë¥¸ìª½: ë¯¸ë¦¬ë³´ê¸° -->
      <section class="panel">
        <h2>
          <span>ğŸ” ë‹¤ì´ì–´ê·¸ë¨ ë¯¸ë¦¬ë³´ê¸°</span>
          <span class="badge">Mermaid.js</span>
        </h2>
        <p class="helper-text">
          GitHub Pages í™˜ê²½ì—ì„œ <b>Mermaid.js</b>ë¡œ ì§ì ‘ ë Œë”ë§í•©ë‹ˆë‹¤.
        </p>

        <div class="preview-wrapper">
          <div id="diagramPreview" class="preview-placeholder">
            Mermaid ì½”ë“œë¥¼ ì…ë ¥í•œ ë’¤<br />
            <b>â€œğŸ¨ ë‹¤ì´ì–´ê·¸ë¨ ë Œë”â€</b> ë˜ëŠ” <b>â€œì˜µì…˜ìœ¼ë¡œ Mermaid ì½”ë“œ ìƒì„±â€</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
          </div>
        </div>

        <div class="status">
          <span class="small">
            URL íŒŒë¼ë¯¸í„° <code>?code=...</code> ë¡œ ë¶ˆëŸ¬ì˜¤ê¸° ì§€ì›.
          </span>
        </div>
      </section>
    </main>

    <footer>
      <div>ğŸ§© Parksy Mermaid Diagram Engine Viewer v2.0</div>
      <div>Â© 2025 dtslib.com | EduArt Engineer</div>
    </footer>
  </div>

  <script>
    // Mermaid ì„¤ì •
    mermaid.initialize({
      startOnLoad: false,
      theme: "default",
      securityLevel: "loose"
    });

    const inputEl = document.getElementById("mermaidInput");
    const previewEl = document.getElementById("diagramPreview");
    const statusMessageEl = document.getElementById("statusMessage");
    const statusLengthEl = document.getElementById("statusLength");

    // ì—”ì§„ ê´€ë ¨ ì—˜ë¦¬ë¨¼íŠ¸
    const typeEl = document.getElementById("engineDiagramType");
    const titleEl = document.getElementById("engineTitle");
    const primaryEl = document.getElementById("enginePrimaryCount");
    const secondaryEl = document.getElementById("engineSecondaryCount");
    const secondaryRowEl = document.getElementById("secondaryRow");
    const primaryLabelEl = document.getElementById("primaryLabel");
    const secondaryLabelEl = document.getElementById("secondaryLabel");
    const primaryHintEl = document.getElementById("primaryHint");
    const secondaryHintEl = document.getElementById("secondaryHint");

    const engineLabelMap = {
      timeline: {
        primaryLabel: "ë‹¨ê³„ ê°œìˆ˜",
        primaryHint: "íƒ€ì„ë¼ì¸ ë‹¨ê³„ ìˆ˜ (1~8)",
        showSecondary: false
      },
      grid: {
        primaryLabel: "í–‰(Row) ê°œìˆ˜",
        primaryHint: "ì„¸ë¡œ í–‰ ê°œìˆ˜ (1~8)",
        showSecondary: true,
        secondaryLabel: "ì—´(Column) ê°œìˆ˜",
        secondaryHint: "ê°€ë¡œ ì—´ ê°œìˆ˜ (1~8)"
      },
      radial: {
        primaryLabel: "ë¸Œëœì¹˜ ê°œìˆ˜",
        primaryHint: "ì„¼í„°ì—ì„œ ë»—ëŠ” ë¸Œëœì¹˜ ìˆ˜ (1~8)",
        showSecondary: false
      },
      tree: {
        primaryLabel: "ìì‹(Child) ê°œìˆ˜",
        primaryHint: "ë£¨íŠ¸ì—ì„œ ë‚´ë ¤ê°€ëŠ” 1ë‹¨ê³„ ìì‹ ìˆ˜ (1~8)",
        showSecondary: true,
        secondaryLabel: "ì†ì(Grandchild) ê°œìˆ˜",
        secondaryHint: "ê° ìì‹ë‹¹ ìµœëŒ€ ì†ì ìˆ˜ (1~8)"
      }
    };

    function applyEngineLabels() {
      const t = typeEl.value;
      const cfg = engineLabelMap[t];
      if (!cfg) return;
      primaryLabelEl.textContent = cfg.primaryLabel;
      primaryHintEl.textContent = cfg.primaryHint;
      if (cfg.showSecondary) {
        secondaryRowEl.style.display = "flex";
        secondaryLabelEl.textContent = cfg.secondaryLabel;
        secondaryHintEl.textContent = cfg.secondaryHint;
      } else {
        secondaryRowEl.style.display = "none";
      }
    }

    function normalizeMermaidCode(raw) {
      if (!raw) return "";
      let code = raw.trim();
      if (code.startsWith("```")) {
        const lines = code.split("\n");
        if (lines[0].trim().startsWith("```")) lines.shift();
        if (lines.length && lines[lines.length - 1].trim() === "```") lines.pop();
        code = lines.join("\n").trim();
      }
      return code;
    }

    function updateStatus(msg, isError = false) {
      statusMessageEl.textContent = "ìƒíƒœ: " + msg;
      statusMessageEl.classList.toggle("error", isError);
      const len = inputEl.value.length;
      statusLengthEl.textContent = len ? `ê¸¸ì´: ${len}ì` : "";
    }

    function renderDiagram() {
      const raw = inputEl.value;
      const code = normalizeMermaidCode(raw);

      if (!code) {
        previewEl.innerHTML =
          '<div class="preview-placeholder">Mermaid ì½”ë“œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.</div>';
        updateStatus("ì½”ë“œ ì—†ìŒ", true);
        return;
      }

      previewEl.innerHTML = `<div class="mermaid">${code.replace(/</g,"&lt;")}</div>`;

      try {
        mermaid.init(undefined, previewEl.querySelectorAll(".mermaid"));
        updateStatus("ë Œë”ë§ ì™„ë£Œ");
      } catch (e) {
        console.error(e);
        previewEl.innerHTML =
          '<div class="preview-placeholder" style="color:#e74c3c;">â›” Mermaid êµ¬ë¬¸ ì˜¤ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤.</div>';
        updateStatus("Mermaid êµ¬ë¬¸ ì˜¤ë¥˜", true);
      }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ì—”ì§„: ì½”ë“œ ìƒì„± í•¨ìˆ˜ë“¤
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function buildTimeline(title, steps) {
      steps = Math.max(1, Math.min(8, steps || 4));
      const lines = [];
      lines.push("%% Parksy Mermaid Module");
      lines.push("%% timeline");
      lines.push("");
      lines.push("timeline");
      lines.push("  title " + (title || "íƒ€ì„ë¼ì¸"));
      for (let i = 1; i <= steps; i++) {
        lines.push(`  S${i} : ë…¸ë“œ ${i}`);
      }
      return lines.join("\n");
    }

    function buildGrid(title, rows, cols) {
      rows = Math.max(1, Math.min(8, rows || 4));
      cols = Math.max(1, Math.min(8, cols || 4));
      const lines = [];
      lines.push("%% Parksy Mermaid Module");
      lines.push("%% grid " + rows + "x" + cols);
      lines.push("");
      lines.push("flowchart TB");
      lines.push("  classDef cell fill:#ffffff,stroke:#555,stroke-width:1px;");

      lines.push(`  subgraph G[${title || (rows + "x" + cols + " Grid")}]`);
      lines.push("    direction TB");

      for (let r = 1; r <= rows; r++) {
        const rowIds = [];
        for (let c = 1; c <= cols; c++) {
          const id = `R${r}C${c}`;
          rowIds.push(id);
          lines.push(`    ${id}[${r},${c}]:::cell`);
        }
        for (let i = 0; i < rowIds.length - 1; i++) {
          lines.push(`    ${rowIds[i]} --> ${rowIds[i+1]}`);
        }
      }
      lines.push("  end");
      return lines.join("\n");
    }

    function buildRadial(title, branches) {
      branches = Math.max(1, Math.min(8, branches || 4));
      const lines = [];
      lines.push("%% Parksy Mermaid Module");
      lines.push("%% radial / molecule style");
      lines.push("");
      lines.push("mindmap");
      lines.push(`  root((${title || "ì¤‘ì‹¬ ê°œë…"}))`);
      for (let i = 1; i <= branches; i++) {
        lines.push(`    B${i}(ë¸Œëœì¹˜ ${i})`);
      }
      return lines.join("\n");
    }

    function buildTree(title, children, grandchildren) {
      children = Math.max(1, Math.min(8, children || 3));
      grandchildren = Math.max(0, Math.min(8, grandchildren || 0));
      const lines = [];
      lines.push("%% Parksy Mermaid Module");
      lines.push("%% tree / family style");
      lines.push("");
      lines.push("graph TD");
      lines.push(`  ROOT[${title || "ë£¨íŠ¸ ë…¸ë“œ"}]`);
      for (let c = 1; c <= children; c++) {
        const childId = `C${c}`;
        lines.push(`  ROOT --> ${childId}[ìì‹ ${c}]`);
        if (grandchildren > 0) {
          for (let g = 1; g <= grandchildren; g++) {
            const gId = `GC${c}_${g}`;
            lines.push(`  ${childId} --> ${gId}[ì†ì ${c}-${g}]`);
          }
        }
      }
      return lines.join("\n");
    }

    function generateFromEngine() {
      const t = typeEl.value;
      const title = titleEl.value.trim();
      const primary = parseInt(primaryEl.value || "0", 10);
      const secondary = parseInt(secondaryEl.value || "0", 10);

      let code = "";
      if (t === "timeline") {
        code = buildTimeline(title, primary);
      } else if (t === "grid") {
        code = buildGrid(title, primary, secondary || 4);
      } else if (t === "radial") {
        code = buildRadial(title, primary);
      } else if (t === "tree") {
        code = buildTree(title, primary, secondary || 0);
      }

      if (!code) {
        updateStatus("ì—”ì§„ ì„¤ì •ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.", true);
        return;
      }
      inputEl.value = code;
      updateStatus("ì—”ì§„ìœ¼ë¡œ Mermaid ì½”ë“œ ìƒì„± ì™„ë£Œ");
      renderDiagram();
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ê¸°ì¡´ ìƒ˜í”Œ/ë³µì‚¬/ê³µìœ  ê¸°ëŠ¥
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const samples = {
      flow: `%% Parksy Mermaid Module
%% ê°„ë‹¨í•œ Flowchart ì˜ˆì‹œ

flowchart TD
  A[ì•„ì´ë””ì–´] --> B[êµ¬ì¡°í™”]
  B --> C[Mermaid ì½”ë“œ]
  C --> D[Excalidraw / PWA / Tistory]
  D --> E[ì¶œíŒ / ë°©ì†¡]`,
      timeline: buildTimeline("ì‘ì—… íƒ€ì„ë¼ì¸", 4),
      graph: `%% Parksy Mermaid Module
%% ë…¸ë“œ ê·¸ë˜í”„ ì˜ˆì‹œ

graph TD
  C((ì¤‘ì•™ ê°œë…))
  A((ëª¨ë“ˆ 1))
  B((ëª¨ë“ˆ 2))
  D((ëª¨ë“ˆ 3))
  E((ëª¨ë“ˆ 4))

  C -- 1 --> A
  C -- 2 --> B
  C -- 3 --> D
  C -- 4 --> E`
    };

    function loadSample(name) {
      const sample = samples[name];
      if (!sample) return;
      inputEl.value = sample;
      updateStatus("ìƒ˜í”Œ ë¡œë“œë¨");
      renderDiagram();
    }

    function createShareLink() {
      const raw = inputEl.value;
      const code = normalizeMermaidCode(raw);
      if (!code) {
        updateStatus("ê³µìœ í•  ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.", true);
        return;
      }
      const url = new URL(window.location.href);
      url.searchParams.set("code", code);
      const shareUrl = url.toString();

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(shareUrl).then(() => {
          updateStatus("ê³µìœ  ë§í¬ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.");
        }).catch(() => {
          updateStatus("ë§í¬ ë³µì‚¬ ì‹¤íŒ¨. ì£¼ì†Œì°½ì—ì„œ ì§ì ‘ ë³µì‚¬í•˜ì„¸ìš”.", true);
          alert(shareUrl);
        });
      } else {
        updateStatus("ìë™ ë³µì‚¬ ë¯¸ì§€ì› ë¸Œë¼ìš°ì €", true);
        alert(shareUrl);
      }
    }

    function copySvg() {
      const svg = previewEl.querySelector("svg");
      if (!svg) {
        updateStatus("ë³µì‚¬í•  SVGê°€ ì—†ìŠµë‹ˆë‹¤.", true);
        return;
      }
      const svgText = svg.outerHTML;
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(svgText).then(() => {
          updateStatus("SVG ì½”ë“œë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.");
        }).catch(() => {
          updateStatus("SVG ë³µì‚¬ ì‹¤íŒ¨", true);
        });
      } else {
        updateStatus("ìë™ ë³µì‚¬ ë¯¸ì§€ì› ë¸Œë¼ìš°ì €", true);
      }
    }

    function copyCode() {
      const raw = inputEl.value;
      if (!raw.trim()) {
        updateStatus("ë³µì‚¬í•  ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.", true);
        return;
      }
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(raw).then(() => {
          updateStatus("Mermaid ì½”ë“œë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.");
        }).catch(() => {
          updateStatus("ì½”ë“œ ë³µì‚¬ ì‹¤íŒ¨", true);
        });
      } else {
        updateStatus("ìë™ ë³µì‚¬ ë¯¸ì§€ì› ë¸Œë¼ìš°ì €", true);
      }
    }

    function loadFromUrl() {
      const params = new URLSearchParams(window.location.search);
      const code = params.get("code");
      if (code) {
        inputEl.value = code;
        updateStatus("URLì—ì„œ ì½”ë“œ ë¡œë“œë¨");
        renderDiagram();
      } else {
        // ê¸°ë³¸: ì—”ì§„ timeline ìƒ˜í”Œ
        inputEl.value = samples.timeline;
        updateStatus("ê¸°ë³¸ íƒ€ì„ë¼ì¸ ìƒ˜í”Œ ë¡œë“œë¨");
        renderDiagram();
      }
    }

    // ì´ë²¤íŠ¸ ë°”ì¸ë”©
    document.getElementById("renderBtn").addEventListener("click", renderDiagram);
    document.getElementById("sampleFlow").addEventListener("click", () => loadSample("flow"));
    document.getElementById("sampleTimeline").addEventListener("click", () => loadSample("timeline"));
    document.getElementById("sampleGraph").addEventListener("click", () => loadSample("graph"));
    document.getElementById("clearBtn").addEventListener("click", () => {
      inputEl.value = "";
      previewEl.innerHTML =
        '<div class="preview-placeholder">Mermaid ì½”ë“œë¥¼ ì…ë ¥í•œ ë’¤<br><b>â€œğŸ¨ ë‹¤ì´ì–´ê·¸ë¨ ë Œë”â€</b> ë˜ëŠ” <b>â€œì˜µì…˜ìœ¼ë¡œ Mermaid ì½”ë“œ ìƒì„±â€</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>';
      updateStatus("ì´ˆê¸°í™” ì™„ë£Œ");
    });
    document.getElementById("shareLinkBtn").addEventListener("click", createShareLink);
    document.getElementById("copySvgBtn").addEventListener("click", copySvg);
    document.getElementById("copyCodeBtn").addEventListener("click", copyCode);

    inputEl.addEventListener("input", () => {
      updateStatus("í¸ì§‘ ì¤‘");
    });

    typeEl.addEventListener("change", applyEngineLabels);
    document.getElementById("engineGenerateBtn").addEventListener("click", generateFromEngine);
    document.getElementById("engineSampleTimelineBtn").addEventListener("click", () => {
      typeEl.value = "timeline";
      applyEngineLabels();
      titleEl.value = "ì‘ì—… íƒ€ì„ë¼ì¸";
      primaryEl.value = 4;
      generateFromEngine();
    });

    // ì´ˆê¸° ì„¸íŒ…
    applyEngineLabels();
    loadFromUrl();
  </script>
</body>
</html>
